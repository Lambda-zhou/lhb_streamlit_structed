# 股票分析系统 Pro - 模块化版本

## 项目结构

本项目已经成功从单一的大文件 `lhb_streamlit_pro.py` 重构为模块化结构，提高了代码的可维护性和可读性。

### 文件结构

```
lhb_streamlit-master/
├── main.py                    # 主程序入口文件
├── utils_streamlit.py         # 工具函数和核心类
├── stock_streamlit.py         # 股票查询与K线图模块
├── lhb_streamlit.py           # 龙虎榜查询模块
├── ths_streamlit.py           # 同花顺热榜模块
├── db_streamlit.py            # 数据库管理模块
├── history_streamlit.py       # 历史记录面板模块
├── lhb_streamlit_pro.py       # 原始文件（保留作为备份）
├── requirements.txt           # 依赖包列表
└── README.md                  # 原始说明文档
```

## 模块说明

### 1. main.py
- **功能**: 主程序入口，整合所有模块
- **职责**: 
  - 页面配置和初始化
  - 模块导入和状态管理
  - 主界面布局和导航
  - 功能模块的调用和协调

### 2. utils_streamlit.py
- **功能**: 核心工具函数和类
- **包含**:
  - `DataPersistence` 类：数据持久化管理
  - `safe_import()` 函数：安全模块导入
  - 股票数据获取和缓存函数
  - K线图保存和管理函数
  - 数据库查询辅助函数

### 3. stock_streamlit.py
- **功能**: 股票查询与K线图绘制
- **包含**:
  - `handle_stock_query()` 函数：处理股票查询逻辑
  - `display_stock_info()` 函数：显示股票信息
  - 支持API查询和数据库查询两种方式

### 4. lhb_streamlit.py
- **功能**: 龙虎榜查询功能
- **包含**:
  - `handle_lhb_query()` 函数：处理龙虎榜查询
  - 支持查询是否在龙虎榜和获取详细数据

### 5. ths_streamlit.py
- **功能**: 同花顺热榜功能
- **包含**:
  - `handle_ths_hot()` 函数：处理热榜数据获取和显示
  - 热榜股票筛选功能
  - 概念统计功能
  - 热榜股票K线图绘制

### 6. db_streamlit.py
- **功能**: 数据库管理功能
- **包含**:
  - `handle_database_management()` 函数：处理数据库操作
  - 数据库连接测试
  - 数据库更新功能

### 7. history_streamlit.py
- **功能**: 历史记录管理
- **包含**:
  - `show_history_panel()` 函数：显示历史记录面板
  - 历史记录筛选和统计
  - 数据导出功能

## 使用方法

### 运行主程序
```bash
streamlit run main.py
```

### 开发新功能
1. 在相应的模块文件中添加新函数
2. 在 `main.py` 中导入新函数
3. 在主界面中添加相应的调用逻辑

### 修改现有功能
1. 直接修改对应模块文件中的函数
2. 无需修改其他模块，保持模块间的独立性

## 优势

### 1. 代码组织
- **模块化**: 每个功能模块独立，便于维护
- **职责分离**: 每个文件都有明确的职责范围
- **代码复用**: 工具函数可以在多个模块间共享

### 2. 维护性
- **易于调试**: 问题定位到具体模块
- **易于扩展**: 新增功能不影响现有模块
- **易于测试**: 可以单独测试每个模块

### 3. 团队协作
- **并行开发**: 不同开发者可以同时开发不同模块
- **代码审查**: 模块级别的代码审查更加高效
- **版本控制**: 模块级别的变更更容易追踪

## 注意事项

### 1. 循环导入
- 已通过参数传递的方式避免循环导入
- 模块间通过函数参数传递依赖关系

### 2. 状态管理
- 使用 `st.session_state` 管理全局状态
- 模块间通过参数传递共享数据

### 3. 错误处理
- 每个模块都有独立的错误处理机制
- 统一的错误提示和日志记录

## 迁移说明

### 从原始版本迁移
1. 原始文件 `lhb_streamlit_pro.py` 保持不变，作为备份
2. 新版本使用 `main.py` 作为入口
3. 所有功能保持完全一致，用户体验无变化

### 兼容性
- 所有依赖包保持不变
- 数据文件格式保持不变
- 配置文件保持不变

## 未来扩展

### 1. 新功能模块
- 可以轻松添加新的功能模块
- 遵循现有的模块化架构

### 2. 插件系统
- 可以考虑实现插件系统
- 支持动态加载功能模块

### 3. 配置管理
- 可以添加配置文件管理
- 支持模块级别的配置

## 总结

通过模块化重构，项目代码结构更加清晰，维护性大大提升。每个模块都有明确的职责，便于团队协作和功能扩展。同时保持了原有功能的完整性，用户体验无任何变化。
